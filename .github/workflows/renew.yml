name: Freecloudè‡ªåŠ¨ç»­è´¹

on:
  schedule:
    # æ¯å¤©åŒ—äº¬æ—¶é—´æ—©ä¸Š6ç‚¹è¿è¡Œï¼ˆUTCæ—¶é—´22ç‚¹ï¼‰
    - cron: '0 22 * * *'
  workflow_dispatch:  # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  renew:
    runs-on: ubuntu-latest
    
    steps:
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v3
        
      - name: è®¾ç½®Pythonç¯å¢ƒ
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
          
      - name: åˆ—å‡ºå·¥ä½œç›®å½•å†…å®¹
        run: |
          echo "å½“å‰å·¥ä½œç›®å½•: $(pwd)"
          echo "åˆ—å‡ºç›®å½•å†…å®¹:"
          ls -la
      
      - name: ç¡®ä¿å¿…è¦æ–‡ä»¶å­˜åœ¨
        run: |
          if [ ! -f "requirements.txt" ]; then
            echo "åˆ›å»ºrequirements.txtæ–‡ä»¶..."
            echo "requests==2.31.0" > requirements.txt
            echo "cloudscraper==1.2.71" >> requirements.txt
            echo "requirements.txtæ–‡ä»¶å·²åˆ›å»º"
          fi
          
          # æ£€æŸ¥è„šæœ¬æ–‡ä»¶æ˜¯å¦å­˜åœ¨
          SCRIPT_PATH=$(find . -name "freecloud_renewer.py" -type f | head -n 1)
          if [ -z "$SCRIPT_PATH" ]; then
            echo "é”™è¯¯: æ‰¾ä¸åˆ°è„šæœ¬æ–‡ä»¶ freecloud_renewer.py"
            exit 1
          else
            echo "æ‰¾åˆ°è„šæœ¬: $SCRIPT_PATH"
            
            # ä¿®å¤ä¸­æ–‡å¼•å·é—®é¢˜
            echo "æ£€æŸ¥å¹¶ä¿®å¤è„šæœ¬ä¸­çš„ä¸­æ–‡å¼•å·é—®é¢˜..."
            sed -i 's/log_message(f"æœªèƒ½åœ¨æœåŠ¡å™¨ {machine_id_to_find} é™„è¿‘æ‰¾åˆ°"å¤©å"ä¿¡æ¯")/log_message(f"æœªèƒ½åœ¨æœåŠ¡å™¨ {machine_id_to_find} é™„è¿‘æ‰¾åˆ°\\"å¤©å\\"ä¿¡æ¯")/' "$SCRIPT_PATH"
            
            # æ£€æŸ¥è„šæœ¬æ–‡ä»¶ä¸­çš„è¯­æ³•é”™è¯¯
            python -m py_compile "$SCRIPT_PATH" || {
              echo "è„šæœ¬ä¸­å­˜åœ¨è¯­æ³•é”™è¯¯ï¼Œå°è¯•ä¿®å¤..."
              # æ£€æŸ¥å¹¶ä¿®å¤ç‰¹å®šçš„è¯­æ³•é”™è¯¯
              sed -i 's/f"ğŸ†˜ è„šæœ¬æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿæ„å¤–æ€»é”™è¯¯: {e}\\n\\n```/f"ğŸ†˜ è„šæœ¬æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿæ„å¤–æ€»é”™è¯¯: {e}\\n\\n```\\n/g' "$SCRIPT_PATH"
              sed -i 's/{error_details}\\n```"/{error_details}\\n```"/g' "$SCRIPT_PATH"
              
              # é€šç”¨ä¿®å¤ï¼šå°†f-stringä¸­çš„ä¸­æ–‡å¼•å·æ›¿æ¢ä¸ºè½¬ä¹‰çš„è‹±æ–‡å¼•å·
              echo "å°è¯•ä¿®å¤æ‰€æœ‰f-stringä¸­çš„ä¸­æ–‡å¼•å·..."
              grep -n 'f".*".*"' "$SCRIPT_PATH" || true
              sed -i 's/\(f"[^"]*\)"$$$$\([^"]*\)"\([^"]*"\)/\1\\"$$$$\2\\"\3/g' "$SCRIPT_PATH"
              
              echo "å°è¯•ä¿®å¤å®Œæˆï¼Œå†æ¬¡æ£€æŸ¥è¯­æ³•..."
              python -m py_compile "$SCRIPT_PATH" || {
                echo "ä»ç„¶å­˜åœ¨è¯­æ³•é”™è¯¯ï¼Œå°è¯•æ‰‹åŠ¨æ›´æ–°è„šæœ¬ä¸­é—®é¢˜è¡Œ..."
                # å¦‚æœç¼–è¯‘ä»ç„¶å¤±è´¥ï¼Œåˆ›å»ºä¸€ä¸ªä¸´æ—¶å‰¯æœ¬è¿›è¡Œæ›´å¤šè°ƒè¯•
                cp "$SCRIPT_PATH" "${SCRIPT_PATH}.bak"
                echo "#!/usr/bin/env python3" > "$SCRIPT_PATH"
                echo "print('æ£€æµ‹åˆ°è„šæœ¬è¯­æ³•é”™è¯¯ï¼Œæ— æ³•è‡ªåŠ¨ä¿®å¤ã€‚è¯·æŸ¥çœ‹æ—¥å¿—å¹¶æ‰‹åŠ¨ä¿®å¤é—®é¢˜ã€‚')" >> "$SCRIPT_PATH"
                echo "exit(1)" >> "$SCRIPT_PATH"
                echo "ä¸¥é‡é”™è¯¯: æ— æ³•ä¿®å¤è„šæœ¬ä¸­çš„è¯­æ³•é—®é¢˜ï¼Œå·²åˆ›å»ºç®€åŒ–ç‰ˆæœ¬ä»¥é˜²æ­¢å®Œå…¨å¤±è´¥ã€‚"
                echo "è¯·æ‰‹åŠ¨æ£€æŸ¥å’Œä¿®å¤åŸå§‹è„šæœ¬: ${SCRIPT_PATH}.bak"
              }
            }
          fi
          
      - name: å®‰è£…ä¾èµ–
        run: |
          python -m pip install --upgrade pip
          cat requirements.txt
          pip install -r requirements.txt
      
      - name: åˆ›å»ºç¯å¢ƒæ£€æŸ¥è„šæœ¬
        run: |
          echo '#!/usr/bin/env python3' > check_env.py
          echo '# -*- coding: utf-8 -*-' >> check_env.py
          echo '' >> check_env.py
          echo 'import os' >> check_env.py
          echo 'import sys' >> check_env.py
          echo 'import glob' >> check_env.py
          echo 'import platform' >> check_env.py
          echo '' >> check_env.py
          echo 'print("==== ç¯å¢ƒæ£€æŸ¥å·¥å…· ====")'  >> check_env.py
          echo 'print(f"Pythonç‰ˆæœ¬: {sys.version}")' >> check_env.py
          echo 'print(f"ç³»ç»Ÿå¹³å°: {platform.platform()}")' >> check_env.py
          echo 'print(f"å½“å‰å·¥ä½œç›®å½•: {os.getcwd()}")' >> check_env.py
          echo '' >> check_env.py
          echo 'print("\\n==== ç¯å¢ƒå˜é‡æ£€æŸ¥ ====")'  >> check_env.py
          echo 'required_vars = ["FC_USERNAME", "FC_PASSWORD", "FC_MACHINE_ID", "TELEGRAM_BOT_TOKEN", "TELEGRAM_CHAT_ID"]' >> check_env.py
          echo '' >> check_env.py
          echo 'for var in required_vars:' >> check_env.py
          echo '    value = os.getenv(var)' >> check_env.py
          echo '    if value:' >> check_env.py
          echo '        masked = value[:2] + "*" * (len(value) - 4) + value[-2:] if len(value) > 4 else "****"' >> check_env.py
          echo '        print(f"{var}: {masked} [å·²è®¾ç½®]")' >> check_env.py
          echo '    else:' >> check_env.py
          echo '        print(f"{var}: [æœªè®¾ç½®]")' >> check_env.py
          echo '' >> check_env.py
          echo 'print("\\n==== ç›®å½•å†…å®¹ ====")'  >> check_env.py
          echo 'for item in sorted(os.listdir(".")):' >> check_env.py
          echo '    if os.path.isdir(item):' >> check_env.py
          echo '        print(f"ğŸ“ {item}/")' >> check_env.py
          echo '    else:' >> check_env.py
          echo '        print(f"ğŸ“„ {item} ({os.path.getsize(item)} å­—èŠ‚)")' >> check_env.py
          echo '' >> check_env.py
          echo 'print("\\n==== æŸ¥æ‰¾è„šæœ¬æ–‡ä»¶ ====")'  >> check_env.py
          echo 'script_paths = glob.glob("**/*freecloud*py", recursive=True)' >> check_env.py
          echo 'if script_paths:' >> check_env.py
          echo '    print("æ‰¾åˆ°ä»¥ä¸‹è„šæœ¬æ–‡ä»¶:")' >> check_env.py
          echo '    for path in script_paths:' >> check_env.py
          echo '        print(f"- {path} ({os.path.getsize(path)} å­—èŠ‚)")' >> check_env.py
          echo 'else:' >> check_env.py
          echo '    print("æœªæ‰¾åˆ°ä»»ä½•åŒ¹é… *freecloud*py çš„è„šæœ¬æ–‡ä»¶")' >> check_env.py
          echo '' >> check_env.py
          echo 'print("\\n==== æ£€æŸ¥å®Œæˆ ====")'  >> check_env.py
          echo "ç¯å¢ƒæ£€æŸ¥è„šæœ¬å·²åˆ›å»º"
          cat check_env.py
          
      - name: ç¯å¢ƒæ£€æŸ¥
        env:
          FC_USERNAME: ${{ secrets.FC_USERNAME }}
          FC_PASSWORD: ${{ secrets.FC_PASSWORD }}
          FC_MACHINE_ID: ${{ secrets.FC_MACHINE_ID }}
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
          DEBUG_MODE: 'true'
        run: python check_env.py
          
      - name: ä½¿ç”¨curlç›´æ¥è®¿é—®ç½‘ç«™ç»­è´¹
        env:
          FC_USERNAME: ${{ secrets.FC_USERNAME }}
          FC_PASSWORD: ${{ secrets.FC_PASSWORD }}
          FC_MACHINE_ID: ${{ secrets.FC_MACHINE_ID }}
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: |
          echo "å°è¯•ä½¿ç”¨curlç›´æ¥è®¿é—®ç½‘ç«™..."
          
          # åˆ›å»ºéšæœºUser-Agent
          USER_AGENTS=(
            "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/123.0.0.0 Safari/537.36"
            "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36"
            "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/123.0.0.0 Safari/537.36"
            "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:123.0) Gecko/20100101 Firefox/123.0"
          )
          
          RANDOM_INDEX=$((RANDOM % ${#USER_AGENTS[@]}))
          RANDOM_UA="${USER_AGENTS[$RANDOM_INDEX]}"
          
          # å¢åŠ é¢å¤–çš„HTTPå¤´ä»¥æ›´åƒçœŸå®æµè§ˆå™¨
          ACCEPT_HEADER="text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7"
          ACCEPT_LANGUAGE="zh-CN,zh;q=0.9,en;q=0.8"
          ACCEPT_ENCODING="gzip, deflate, br"
          
          # åˆ›å»ºä¸€ä¸ªåŒ…å«æ‰€æœ‰cookieçš„ä¸´æ—¶æ–‡ä»¶
          COOKIE_JAR="cookies.txt"
          
          # é¦–å…ˆè®¿é—®é¦–é¡µè·å–åˆå§‹cookieå’ŒCSRFä»¤ç‰Œ
          echo "è®¿é—®é¦–é¡µè·å–åˆå§‹cookieå’ŒCSRFä»¤ç‰Œ..."
          HOME_PAGE=$(curl -s -c "$COOKIE_JAR" -b "$COOKIE_JAR" \
            -H "User-Agent: $RANDOM_UA" \
            -H "Accept: $ACCEPT_HEADER" \
            -H "Accept-Language: $ACCEPT_LANGUAGE" \
            -H "Accept-Encoding: $ACCEPT_ENCODING" \
            -H "Connection: keep-alive" \
            -H "Upgrade-Insecure-Requests: 1" \
            -H "Sec-Fetch-Dest: document" \
            -H "Sec-Fetch-Mode: navigate" \
            -H "Sec-Fetch-Site: none" \
            -H "Sec-Fetch-User: ?1" \
            --compressed \
            --max-time 30 "https://freecloud.ltd/")
          
          # æå–CSRFä»¤ç‰Œ
          CSRF_TOKEN=$(echo "$HOME_PAGE" | grep -o 'name="_token" value="[^"]*"' | sed 's/name="_token" value="//g' | sed 's/"//g' || echo "")
          if [ -n "$CSRF_TOKEN" ]; then
            echo "æ‰¾åˆ°CSRFä»¤ç‰Œ: ${CSRF_TOKEN:0:10}..."
          else
            echo "æœªæ‰¾åˆ°CSRFä»¤ç‰Œï¼Œç»§ç»­å°è¯•..."
          fi
          
          # æ¨¡æ‹Ÿäººç±»è¡Œä¸ºï¼šéšæœºåœé¡¿
          SLEEP_TIME=$(( RANDOM % 3 + 2 ))
          echo "æ¨¡æ‹Ÿäººç±»è¡Œä¸ºï¼Œéšæœºåœé¡¿ ${SLEEP_TIME} ç§’..."
          sleep $SLEEP_TIME
          
          # è®¿é—®ç™»å½•é¡µé¢è·å–æ•°å­¦éªŒè¯ç 
          echo "è®¿é—®ç™»å½•é¡µé¢è·å–æ•°å­¦éªŒè¯ç ..."
          LOGIN_PAGE=$(curl -s -c "$COOKIE_JAR" -b "$COOKIE_JAR" \
            -H "User-Agent: $RANDOM_UA" \
            -H "Accept: $ACCEPT_HEADER" \
            -H "Accept-Language: $ACCEPT_LANGUAGE" \
            -H "Accept-Encoding: $ACCEPT_ENCODING" \
            -H "Connection: keep-alive" \
            -H "Upgrade-Insecure-Requests: 1" \
            -H "Referer: https://freecloud.ltd/" \
            -H "Sec-Fetch-Dest: document" \
            -H "Sec-Fetch-Mode: navigate" \
            -H "Sec-Fetch-Site: same-origin" \
            -H "Sec-Fetch-User: ?1" \
            --compressed \
            --max-time 30 "https://freecloud.ltd/login")
          
          # ä¿å­˜ç™»å½•é¡µé¢å†…å®¹ä»¥ä¾¿è°ƒè¯•
          echo "ä¿å­˜ç™»å½•é¡µé¢å†…å®¹ä»¥ä¾¿è°ƒè¯•..."
          echo "$LOGIN_PAGE" | grep -i -A 3 -B 3 "captcha\|éªŒè¯ç \|math" > login_page_debug.txt
          cat login_page_debug.txt
          
          # ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æå–æ•°å­¦éªŒè¯ç é¢˜ç›®
          MATH_QUESTION=$(echo "$LOGIN_PAGE" | grep -o 'placeholder="[0-9]\+ [+*/\-] [0-9]\+ = ?"' | head -1 || true)
          
          if [ -z "$MATH_QUESTION" ]; then
            echo "æœªèƒ½æ‰¾åˆ°æ•°å­¦éªŒè¯ç é¢˜ç›®ï¼Œå°è¯•å…¶ä»–åŒ¹é…æ¨¡å¼..."
            # å°è¯•å…¶ä»–åŒ¹é…æ¨¡å¼
            MATH_QUESTION=$(echo "$LOGIN_PAGE" | grep -o 'placeholder="[0-9]+ [+*/\-] [0-9]+ = ?"' || true)
            
            if [ -z "$MATH_QUESTION" ]; then
              echo "ä»æœªæ‰¾åˆ°æ•°å­¦éªŒè¯ç é¢˜ç›®ï¼Œå°è¯•ç›´æ¥ç™»å½•"
              MATH_ANSWER=""
            else
              echo "ä½¿ç”¨ç¬¬äºŒç§æ¨¡å¼æ‰¾åˆ°éªŒè¯ç é—®é¢˜: $MATH_QUESTION"
            fi
          else
            echo "æ‰¾åˆ°éªŒè¯ç é—®é¢˜: $MATH_QUESTION"
          fi
          
          if [ -n "$MATH_QUESTION" ]; then
            # æå–æ•°å­—å’Œè¿ç®—ç¬¦
            NUM1=$(echo "$MATH_QUESTION" | grep -o -E '[0-9]+' | head -1)
            OP=$(echo "$MATH_QUESTION" | grep -o -E '[+*/\-]')
            NUM2=$(echo "$MATH_QUESTION" | grep -o -E '[0-9]+' | tail -1)
            
            echo "è§£æéªŒè¯ç : ç¬¬ä¸€ä¸ªæ•°å­—=$NUM1, è¿ç®—ç¬¦=$OP, ç¬¬äºŒä¸ªæ•°å­—=$NUM2"
            
            # è®¡ç®—ç­”æ¡ˆ
            if [ "$OP" = "+" ]; then
              MATH_ANSWER=$((NUM1 + NUM2))
            elif [ "$OP" = "-" ]; then
              MATH_ANSWER=$((NUM1 - NUM2))
            elif [ "$OP" = "*" ]; then
              MATH_ANSWER=$((NUM1 * NUM2))
            elif [ "$OP" = "/" ]; then
              MATH_ANSWER=$((NUM1 / NUM2))
            else
              MATH_ANSWER=""
            fi
            
            echo "è®¡ç®—ç»“æœ: $MATH_ANSWER"
          fi
          
          # ç™»å½•è¯·æ±‚
          echo "å°è¯•ç™»å½•..."
          
          # æ¨¡æ‹Ÿäººç±»è¡Œä¸ºï¼šéšæœºåœé¡¿
          SLEEP_TIME=$(( RANDOM % 3 + 2 ))
          echo "æ¨¡æ‹Ÿäººç±»è¡Œä¸ºï¼Œéšæœºåœé¡¿ ${SLEEP_TIME} ç§’..."
          sleep $SLEEP_TIME
          
          # å‡†å¤‡ç™»å½•æ•°æ®
          LOGIN_DATA=""
          if [ -n "$CSRF_TOKEN" ]; then
            LOGIN_DATA="_token=$CSRF_TOKEN&"
          fi
          LOGIN_DATA="${LOGIN_DATA}username=$FC_USERNAME&password=$FC_PASSWORD&math_captcha=$MATH_ANSWER&mobile=&captcha=&verify_code=&agree=1&login_type=PASS&submit=1"
          
          LOGIN_RESULT=$(curl -s -c "$COOKIE_JAR" -b "$COOKIE_JAR" \
            -X POST \
            -H "User-Agent: $RANDOM_UA" \
            -H "Content-Type: application/x-www-form-urlencoded" \
            -H "Accept: $ACCEPT_HEADER" \
            -H "Accept-Language: $ACCEPT_LANGUAGE" \
            -H "Accept-Encoding: $ACCEPT_ENCODING" \
            -H "Connection: keep-alive" \
            -H "Referer: https://freecloud.ltd/login" \
            -H "Origin: https://freecloud.ltd" \
            -H "Sec-Fetch-Dest: document" \
            -H "Sec-Fetch-Mode: navigate" \
            -H "Sec-Fetch-Site: same-origin" \
            -H "Sec-Fetch-User: ?1" \
            --data "$LOGIN_DATA" \
            --compressed \
            --max-time 30 \
            "https://freecloud.ltd/login")
          
          # æŸ¥çœ‹cookieæ–‡ä»¶
          echo "Cookieæ–‡ä»¶å†…å®¹:"
          cat "$COOKIE_JAR" || echo "æ— æ³•è¯»å–Cookieæ–‡ä»¶"
          
          # æ£€æŸ¥ç™»å½•æ˜¯å¦æˆåŠŸ - ä½¿ç”¨å¤šç§æ–¹æ³•æ£€æŸ¥
          echo "éªŒè¯ç™»å½•çŠ¶æ€..."
          sleep 3
          
          # æ–¹æ³•1ï¼šç›´æ¥è¯·æ±‚æœåŠ¡å™¨é¡µé¢
          CONSOLE_PAGE=$(curl -s -c "$COOKIE_JAR" -b "$COOKIE_JAR" \
            -H "User-Agent: $RANDOM_UA" \
            -H "Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8" \
            -H "Accept-Language: zh-CN,zh;q=0.9,en;q=0.8" \
            -H "Referer: https://freecloud.ltd/login" \
            --compressed \
            --max-time 30 "https://freecloud.ltd/server/lxc")
          
          # æ£€æŸ¥æ˜¯å¦å­˜åœ¨æˆåŠŸç™»å½•çš„æ ‡å¿—
          if echo "$CONSOLE_PAGE" | grep -q "é€€å‡ºç™»å½•\|logout\|æ¬¢è¿å›æ¥"; then
            echo "ç™»å½•æˆåŠŸï¼Œæ£€æŸ¥æœåŠ¡å™¨ä¿¡æ¯..."
            
            # æŸ¥æ‰¾æœåŠ¡å™¨ä¿¡æ¯
            MACHINE_ID="$FC_MACHINE_ID"
            SERVER_INFO=$(echo "$CONSOLE_PAGE" | grep -A 50 -B 50 "$MACHINE_ID" | grep -o '[0-9]\+å¤©å')
            
            if [ -n "$SERVER_INFO" ]; then
              DAYS_LEFT=$(echo "$SERVER_INFO" | grep -o '[0-9]\+')
              echo "æœåŠ¡å™¨ $MACHINE_ID å‰©ä½™ $DAYS_LEFT å¤©"
              
              # åˆ¤æ–­æ˜¯å¦éœ€è¦ç»­è´¹
              if [ "$DAYS_LEFT" -lt 3 ]; then
                echo "å‰©ä½™å¤©æ•°å°‘äº3å¤©ï¼Œéœ€è¦ç»­è´¹"
                
                # è®¿é—®æœåŠ¡å™¨è¯¦æƒ…é¡µ
                echo "è®¿é—®æœåŠ¡å™¨è¯¦æƒ…é¡µ..."
                sleep 2
                curl -s -c "$COOKIE_JAR" -b "$COOKIE_JAR" -A "$RANDOM_UA" --max-time 30 "https://freecloud.ltd/server/detail/$MACHINE_ID" > /dev/null
                
                # æ‰§è¡Œç»­è´¹æ“ä½œ
                echo "æ‰§è¡Œç»­è´¹æ“ä½œ..."
                sleep 2
                RENEW_RESULT=$(curl -s -c "$COOKIE_JAR" -b "$COOKIE_JAR" -A "$RANDOM_UA" \
                  -X POST \
                  -H "Content-Type: application/x-www-form-urlencoded" \
                  -H "X-Requested-With: XMLHttpRequest" \
                  -H "Referer: https://freecloud.ltd/server/detail/$MACHINE_ID" \
                  --data-urlencode "month=1" \
                  --data-urlencode "coupon_id=0" \
                  --data-urlencode "submit=1" \
                  --max-time 45 \
                  "https://freecloud.ltd/server/detail/$MACHINE_ID/renew")
                  
                echo "ç»­è´¹ç»“æœ: $RENEW_RESULT"
                
                # å‘é€Telegramé€šçŸ¥
                if [ -n "$TELEGRAM_BOT_TOKEN" ] && [ -n "$TELEGRAM_CHAT_ID" ]; then
                  if echo "$RENEW_RESULT" | grep -q "success\|æˆåŠŸ\|code\":0"; then
                    MESSAGE="âœ… æœåŠ¡å™¨ $MACHINE_ID ç»­è´¹æˆåŠŸï¼åŸå‰©ä½™: $DAYS_LEFT å¤©ã€‚"
                  else
                    MESSAGE="âŒ æœåŠ¡å™¨ $MACHINE_ID ç»­è´¹å¤±è´¥ã€‚åŸå‰©ä½™: $DAYS_LEFT å¤©ã€‚"
                  fi
                  
                  curl -s -X POST \
                    -H "Content-Type: application/json" \
                    --data "{\"chat_id\":\"$TELEGRAM_CHAT_ID\",\"text\":\"$MESSAGE\",\"parse_mode\":\"Markdown\"}" \
                    "https://api.telegram.org/bot$TELEGRAM_BOT_TOKEN/sendMessage"
                fi
              else
                echo "å‰©ä½™å¤©æ•°ä¸º $DAYS_LEFT å¤©ï¼Œæ— éœ€ç»­è´¹"
                
                # å‘é€Telegramé€šçŸ¥
                if [ -n "$TELEGRAM_BOT_TOKEN" ] && [ -n "$TELEGRAM_CHAT_ID" ]; then
                  MESSAGE="â„¹ï¸ æœåŠ¡å™¨ $MACHINE_ID å‰©ä½™ $DAYS_LEFT å¤©ï¼Œæ— éœ€ç»­è´¹ã€‚"
                  
                  curl -s -X POST \
                    -H "Content-Type: application/json" \
                    --data "{\"chat_id\":\"$TELEGRAM_CHAT_ID\",\"text\":\"$MESSAGE\",\"parse_mode\":\"Markdown\"}" \
                    "https://api.telegram.org/bot$TELEGRAM_BOT_TOKEN/sendMessage"
                fi
              fi
            else
              echo "æœªèƒ½æ‰¾åˆ°æœåŠ¡å™¨ $MACHINE_ID çš„å‰©ä½™å¤©æ•°ä¿¡æ¯"
              
              # å‘é€Telegramé€šçŸ¥
              if [ -n "$TELEGRAM_BOT_TOKEN" ] && [ -n "$TELEGRAM_CHAT_ID" ]; then
                MESSAGE="âš ï¸ æœªèƒ½æ‰¾åˆ°æœåŠ¡å™¨ $MACHINE_ID çš„ä¿¡æ¯ï¼Œæ— æ³•ç»­è´¹ã€‚"
                
                curl -s -X POST \
                  -H "Content-Type: application/json" \
                  --data "{\"chat_id\":\"$TELEGRAM_CHAT_ID\",\"text\":\"$MESSAGE\",\"parse_mode\":\"Markdown\"}" \
                  "https://api.telegram.org/bot$TELEGRAM_BOT_TOKEN/sendMessage"
              fi
            fi
          else
            echo "ç™»å½•å¤±è´¥ï¼Œæ— æ³•è·å–æœåŠ¡å™¨ä¿¡æ¯"
            
            # å‘é€Telegramé€šçŸ¥
            if [ -n "$TELEGRAM_BOT_TOKEN" ] && [ -n "$TELEGRAM_CHAT_ID" ]; then
              MESSAGE="ğŸ”´ ä½¿ç”¨curlæ–¹å¼ç™»å½•Freecloudå¤±è´¥ï¼Œæ— æ³•ç»­è´¹ã€‚"
              
              curl -s -X POST \
                -H "Content-Type: application/json" \
                --data "{\"chat_id\":\"$TELEGRAM_CHAT_ID\",\"text\":\"$MESSAGE\",\"parse_mode\":\"Markdown\"}" \
                "https://api.telegram.org/bot$TELEGRAM_BOT_TOKEN/sendMessage"
            fi
          fi
          
          # æ¸…ç†ä¸´æ—¶æ–‡ä»¶
          rm -f "$COOKIE_JAR"
        
      - name: å¦‚æœå¤±è´¥é‡è¯•ä¸€æ¬¡
        if: failure()
        env:
          FC_USERNAME: ${{ secrets.FC_USERNAME }}
          FC_PASSWORD: ${{ secrets.FC_PASSWORD }}
          FC_MACHINE_ID: ${{ secrets.FC_MACHINE_ID }}
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: |
          echo "é¦–æ¬¡è¿è¡Œå¤±è´¥ï¼Œç­‰å¾…30ç§’åä½¿ç”¨æµè§ˆå™¨è‡ªåŠ¨åŒ–æ–¹å¼é‡è¯•..."
          sleep 30
          
          # å®‰è£…æ‰€éœ€å·¥å…·å’Œä¾èµ–
          echo "å®‰è£…Puppeteeræ‰€éœ€çš„ç³»ç»Ÿä¾èµ–..."
          sudo apt-get update
          sudo apt-get install -y ca-certificates fonts-liberation libasound2 libatk-bridge2.0-0 libatk1.0-0 libc6 libcairo2 libcups2 libdbus-1-3 libexpat1 libfontconfig1 libgbm1 libgcc1 libglib2.0-0 libgtk-3-0 libnspr4 libnss3 libpango-1.0-0 libpangocairo-1.0-0 libstdc++6 libx11-6 libx11-xcb1 libxcb1 libxcomposite1 libxcursor1 libxdamage1 libxext6 libxfixes3 libxi6 libxrandr2 libxrender1 libxss1 libxtst6 lsb-release wget xdg-utils
          
          echo "å®‰è£…Node.jsä¾èµ–..."
          npm init -y
          npm install puppeteer puppeteer-extra puppeteer-extra-plugin-stealth
          
          echo "åˆ›å»ºæµè§ˆå™¨è‡ªåŠ¨åŒ–è„šæœ¬..."
          cat > freecloud_puppeteer.js << 'EOL'
          const puppeteer = require('puppeteer-extra');
          const StealthPlugin = require('puppeteer-extra-plugin-stealth');
          puppeteer.use(StealthPlugin());
          
          // è·å–ç¯å¢ƒå˜é‡
          const FC_USERNAME = process.env.FC_USERNAME;
          const FC_PASSWORD = process.env.FC_PASSWORD;
          const FC_MACHINE_ID = process.env.FC_MACHINE_ID;
          const TELEGRAM_BOT_TOKEN = process.env.TELEGRAM_BOT_TOKEN;
          const TELEGRAM_CHAT_ID = process.env.TELEGRAM_CHAT_ID;
          
          // éšæœºå»¶è¿Ÿå‡½æ•°
          const randomDelay = async (min = 1000, max = 3000) => {
            const delay = Math.floor(Math.random() * (max - min)) + min;
            console.log(`éšæœºå»¶è¿Ÿ ${delay}ms...`);
            await new Promise(r => setTimeout(r, delay));
          };
          
          // å‘é€Telegramé€šçŸ¥
          const sendTelegramMessage = async (message) => {
            if (!TELEGRAM_BOT_TOKEN || !TELEGRAM_CHAT_ID) {
              console.log('æœªé…ç½®Telegramé€šçŸ¥');
              return;
            }
            
            try {
              console.log(`å‘é€Telegramé€šçŸ¥: ${message}`);
              const response = await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                  chat_id: TELEGRAM_CHAT_ID,
                  text: message,
                  parse_mode: 'Markdown'
                })
              });
              
              const result = await response.json();
              console.log('Telegramé€šçŸ¥å‘é€ç»“æœ:', result.ok ? 'æˆåŠŸ' : 'å¤±è´¥');
            } catch (error) {
              console.error('å‘é€Telegramé€šçŸ¥æ—¶å‡ºé”™:', error.message);
            }
          };
          
          // ä¸»å‡½æ•°
          (async () => {
            console.log('å¯åŠ¨æµè§ˆå™¨...');
            const browser = await puppeteer.launch({
              headless: true,
              args: [
                '--no-sandbox',
                '--disable-setuid-sandbox',
                '--disable-dev-shm-usage',
                '--disable-accelerated-2d-canvas',
                '--disable-gpu',
                '--window-size=1920,1080',
                '--disable-web-security',
              ]
            });
            
            try {
              const page = await browser.newPage();
              
              // è®¾ç½®è§†çª—å¤§å°
              await page.setViewport({ width: 1920, height: 1080 });
              
              // è®¾ç½®ç”¨æˆ·ä»£ç†
              await page.setUserAgent('Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/123.0.0.0 Safari/537.36');
              
              // ç»•è¿‡WebDriveræ£€æµ‹
              await page.evaluateOnNewDocument(() => {
                delete navigator.__proto__.webdriver;
                
                // æ·»åŠ Chromeæµè§ˆå™¨ç‰¹æ€§
                window.chrome = {
                  runtime: {},
                  loadTimes: function() {},
                  csi: function() {},
                  app: {
                    isInstalled: false,
                  },
                };
                
                // æ·»åŠ è¯­è¨€å’Œå¹³å°ç‰¹æ€§
                Object.defineProperty(navigator, 'languages', {
                  get: () => ['zh-CN', 'zh', 'en-US', 'en'],
                });
                
                Object.defineProperty(navigator, 'plugins', {
                  get: () => [
                    {
                      0: {type: 'application/x-google-chrome-pdf'},
                      description: 'Portable Document Format',
                      filename: 'internal-pdf-viewer',
                      length: 1,
                      name: 'Chrome PDF Plugin'
                    }
                  ],
                });
              });
              
              console.log('è®¿é—®ç™»å½•é¡µé¢...');
              try {
                await page.goto('https://freecloud.ltd/login', { 
                  waitUntil: 'networkidle2',
                  timeout: 60000 
                });
              } catch (error) {
                console.log('è®¿é—®ç™»å½•é¡µé¢è¶…æ—¶æˆ–é”™è¯¯:', error.message);
                console.log('å°è¯•ç»§ç»­...');
              }
              
              // ç­‰å¾…é¡µé¢åŠ è½½å®Œæˆï¼Œæ£€æŸ¥æ˜¯å¦å­˜åœ¨CloudflareæŒ‘æˆ˜
              console.log('æ£€æŸ¥æ˜¯å¦å­˜åœ¨CloudflareæŒ‘æˆ˜...');
              const isChallengePresent = await page.evaluate(() => {
                return document.body.textContent.includes('Checking your browser') || 
                       document.body.textContent.includes('æ­£åœ¨æ£€æŸ¥æ‚¨çš„æµè§ˆå™¨') ||
                       document.title.includes('Cloudflare') ||
                       document.querySelector('div[class*="cf-"]') !== null;
              });
              
              if (isChallengePresent) {
                console.log('æ£€æµ‹åˆ°CloudflareæŒ‘æˆ˜ï¼Œç­‰å¾…æŒ‘æˆ˜å®Œæˆ...');
                try {
                  await page.waitForFunction(
                    () => !document.body.textContent.includes('Checking your browser') && 
                          !document.body.textContent.includes('æ­£åœ¨æ£€æŸ¥æ‚¨çš„æµè§ˆå™¨') && 
                          !document.title.includes('Cloudflare'),
                    { timeout: 30000 }
                  );
                  console.log('CloudflareæŒ‘æˆ˜å·²é€šè¿‡');
                } catch (error) {
                  console.log('ç­‰å¾…CloudflareæŒ‘æˆ˜é€šè¿‡è¶…æ—¶:', error.message);
                  
                  // ä¿å­˜é¡µé¢æˆªå›¾å’ŒHTMLä»¥ä¾¿è°ƒè¯•
                  await page.screenshot({ path: 'cloudflare_challenge.png' });
                  const pageContent = await page.content();
                  console.log('é¡µé¢å†…å®¹ç‰‡æ®µ:', pageContent.substring(0, 500) + '...');
                  
                  console.log('å°è¯•ç»§ç»­æ‰§è¡Œ...');
                }
              }
              
              // ç¡®è®¤æˆ‘ä»¬å·²ç»åœ¨ç™»å½•é¡µé¢
              console.log('ç¡®è®¤å·²è¿›å…¥ç™»å½•é¡µé¢...');
              try {
                await page.waitForSelector('input[name="username"]', { timeout: 10000 });
              } catch (error) {
                console.log('æœªæ‰¾åˆ°ç™»å½•è¡¨å•ï¼Œå°è¯•æ‰‹åŠ¨å¯¼èˆªåˆ°ç™»å½•é¡µ...');
                try {
                  await page.goto('https://freecloud.ltd/login', { waitUntil: 'networkidle2' });
                  await page.waitForSelector('input[name="username"]', { timeout: 10000 });
                } catch (retryError) {
                  console.log('äºŒæ¬¡å°è¯•åä»æœªæ‰¾åˆ°ç™»å½•è¡¨å•:', retryError.message);
                  
                  // ä¿å­˜é¡µé¢æˆªå›¾ä»¥ä¾¿è°ƒè¯•
                  await page.screenshot({ path: 'login_page_error.png' });
                  
                  // å‘é€Telegramé€šçŸ¥
                  await sendTelegramMessage('âŒ æµè§ˆå™¨è‡ªåŠ¨åŒ–å¤±è´¥: æ— æ³•è®¿é—®ç™»å½•é¡µé¢æˆ–æ‰¾ä¸åˆ°ç™»å½•è¡¨å•');
                  return;
                }
              }
              
              // éšæœºå»¶è¿Ÿï¼Œæ¨¡æ‹Ÿäººç±»è¡Œä¸º
              await randomDelay();
              
              // æŸ¥æ‰¾å¹¶å¤„ç†æ•°å­¦éªŒè¯ç 
              console.log('æŸ¥æ‰¾æ•°å­¦éªŒè¯ç ...');
              const mathCaptchaElement = await page.$('input[name="math_captcha"]');
              let mathAnswer = '';
              
              if (mathCaptchaElement) {
                console.log('æ‰¾åˆ°æ•°å­¦éªŒè¯ç è¾“å…¥æ¡†ï¼Œå°è¯•è§£æéªŒè¯ç é—®é¢˜...');
                const placeholder = await page.evaluate(el => el.getAttribute('placeholder'), mathCaptchaElement);
                console.log(`éªŒè¯ç é—®é¢˜: ${placeholder}`);
                
                // è§£ææ•°å­¦é—®é¢˜
                const match = placeholder.match(/(\d+)\s*([+\-*/])\s*(\d+)\s*=\s*\?/);
                if (match) {
                  const num1 = parseInt(match[1]);
                  const operator = match[2];
                  const num2 = parseInt(match[3]);
                  
                  // è®¡ç®—ç­”æ¡ˆ
                  if (operator === '+') {
                    mathAnswer = num1 + num2;
                  } else if (operator === '-') {
                    mathAnswer = num1 - num2;
                  } else if (operator === '*') {
                    mathAnswer = num1 * num2;
                  } else if (operator === '/') {
                    mathAnswer = Math.floor(num1 / num2);
                  }
                  
                  console.log(`éªŒè¯ç ç­”æ¡ˆ: ${mathAnswer}`);
                } else {
                  console.log('æ— æ³•è§£ææ•°å­¦éªŒè¯ç é—®é¢˜');
                }
              } else {
                console.log('æœªæ‰¾åˆ°æ•°å­¦éªŒè¯ç è¾“å…¥æ¡†');
              }
              
              // å¡«å†™ç™»å½•è¡¨å•
              console.log('å¡«å†™ç™»å½•è¡¨å•...');
              await page.type('input[name="username"]', FC_USERNAME);
              await randomDelay(500, 1500);
              await page.type('input[name="password"]', FC_PASSWORD);
              
              // å¦‚æœæ‰¾åˆ°äº†æ•°å­¦éªŒè¯ç ç­”æ¡ˆï¼Œå¡«å…¥
              if (mathAnswer) {
                await randomDelay(500, 1500);
                await page.type('input[name="math_captcha"]', mathAnswer.toString());
              }
              
              // ç¡®ä¿åŒæ„æ¡æ¬¾è¢«é€‰ä¸­
              await randomDelay(500, 1000);
              const agreeCheckbox = await page.$('input[name="agree"]');
              if (agreeCheckbox) {
                const isChecked = await page.evaluate(el => el.checked, agreeCheckbox);
                if (!isChecked) {
                  await page.click('input[name="agree"]');
                }
              }
              
              // æäº¤è¡¨å•
              console.log('æäº¤ç™»å½•è¡¨å•...');
              await randomDelay(1000, 2000);
              
              // ç‚¹å‡»ç™»å½•æŒ‰é’®
              try {
                await Promise.all([
                  page.click('button[type="submit"]'),
                  page.waitForNavigation({ waitUntil: 'networkidle2', timeout: 60000 })
                ]);
              } catch (error) {
                console.log('ç­‰å¾…å¯¼èˆªè¶…æ—¶ï¼Œç»§ç»­æ‰§è¡Œ:', error.message);
              }
              
              // ä¿å­˜ç™»å½•åé¡µé¢çš„æˆªå›¾
              await page.screenshot({ path: 'after_login.png' });
              
              // æ£€æŸ¥æ˜¯å¦ç™»å½•æˆåŠŸ
              console.log('æ£€æŸ¥ç™»å½•çŠ¶æ€...');
              const isLoggedIn = await page.evaluate(() => {
                return document.body.textContent.includes('é€€å‡ºç™»å½•') || 
                       document.body.textContent.includes('logout') || 
                       document.body.textContent.includes('æ¬¢è¿å›æ¥');
              });
              
              if (isLoggedIn) {
                console.log('ç™»å½•æˆåŠŸï¼');
                
                // è®¿é—®æœåŠ¡å™¨åˆ—è¡¨é¡µé¢
                console.log('è®¿é—®æœåŠ¡å™¨åˆ—è¡¨é¡µé¢...');
                try {
                  await page.goto('https://freecloud.ltd/server/lxc', { 
                    waitUntil: 'networkidle2',
                    timeout: 30000 
                  });
                } catch (error) {
                  console.log('è®¿é—®æœåŠ¡å™¨åˆ—è¡¨é¡µé¢è¶…æ—¶:', error.message);
                }
                
                // ä¿å­˜é¡µé¢å†…å®¹ä»¥ä¾¿è°ƒè¯•
                await page.screenshot({ path: 'server_list_page.png' });
                
                // æŸ¥æ‰¾æœåŠ¡å™¨ä¿¡æ¯
                console.log(`æŸ¥æ‰¾æœåŠ¡å™¨ID: ${FC_MACHINE_ID}...`);
                
                // è·å–é¡µé¢å†…å®¹
                const pageContent = await page.content();
                
                // ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æŸ¥æ‰¾å‰©ä½™å¤©æ•°
                const regex = new RegExp(`${FC_MACHINE_ID}[\\s\\S]*?([0-9]+)å¤©å`, 'i');
                const match = pageContent.match(regex);
                
                if (match) {
                  const daysLeft = parseInt(match[1]);
                  console.log(`æœåŠ¡å™¨ ${FC_MACHINE_ID} å‰©ä½™ ${daysLeft} å¤©`);
                  
                  // åˆ¤æ–­æ˜¯å¦éœ€è¦ç»­è´¹
                  if (daysLeft < 3) {
                    console.log('å‰©ä½™å¤©æ•°å°‘äº3å¤©ï¼Œéœ€è¦ç»­è´¹');
                    
                    // è®¿é—®æœåŠ¡å™¨è¯¦æƒ…é¡µ
                    console.log('è®¿é—®æœåŠ¡å™¨è¯¦æƒ…é¡µ...');
                    try {
                      await page.goto(`https://freecloud.ltd/server/detail/${FC_MACHINE_ID}`, { 
                        waitUntil: 'networkidle2',
                        timeout: 30000 
                      });
                    } catch (error) {
                      console.log('è®¿é—®æœåŠ¡å™¨è¯¦æƒ…é¡µè¶…æ—¶:', error.message);
                    }
                    
                    await randomDelay();
                    
                    // æŸ¥æ‰¾å¹¶ç‚¹å‡»ç»­è´¹æŒ‰é’®
                    console.log('æŸ¥æ‰¾ç»­è´¹æŒ‰é’®...');
                    const renewButton = await page.evaluateHandle(() => {
                      // æŸ¥æ‰¾åŒ…å«"ç»­è´¹"æ–‡æœ¬çš„æŒ‰é’®
                      const buttons = Array.from(document.querySelectorAll('button'));
                      const renewButton = buttons.find(btn => 
                        btn.textContent.includes('ç»­è´¹') || 
                        btn.textContent.includes('renew')
                      );
                      
                      return renewButton || null;
                    });
                    
                    if (renewButton) {
                      console.log('æ‰¾åˆ°ç»­è´¹æŒ‰é’®ï¼Œç‚¹å‡»...');
                      await renewButton.click();
                      
                      // ç­‰å¾…ç»­è´¹å¯¹è¯æ¡†å‡ºç°
                      try {
                        await page.waitForFunction(() => {
                          return document.body.textContent.includes('ç»­è´¹æ—¶é•¿') || 
                                 document.body.textContent.includes('Renewal Period');
                        }, { timeout: 10000 });
                      } catch (error) {
                        console.log('ç­‰å¾…ç»­è´¹å¯¹è¯æ¡†è¶…æ—¶:', error.message);
                      }
                      
                      await randomDelay();
                      
                      // é€‰æ‹©1ä¸ªæœˆçš„ç»­è´¹æ—¶é•¿
                      console.log('é€‰æ‹©1ä¸ªæœˆç»­è´¹æ—¶é•¿...');
                      await page.evaluate(() => {
                        // æŸ¥æ‰¾å¹¶é€‰æ‹©1ä¸ªæœˆé€‰é¡¹
                        const monthInputs = Array.from(document.querySelectorAll('input[name="month"]'));
                        const oneMonthInput = monthInputs.find(input => input.value === '1');
                        if (oneMonthInput && !oneMonthInput.checked) {
                          oneMonthInput.click();
                        }
                      });
                      
                      await randomDelay();
                      
                      // æŸ¥æ‰¾å¹¶ç‚¹å‡»ç¡®è®¤æŒ‰é’®
                      console.log('æŸ¥æ‰¾ç¡®è®¤æŒ‰é’®...');
                      const confirmButton = await page.evaluateHandle(() => {
                        // æŸ¥æ‰¾åŒ…å«"ç¡®è®¤"æˆ–"ç¡®å®š"æ–‡æœ¬çš„æŒ‰é’®
                        const buttons = Array.from(document.querySelectorAll('button'));
                        const confirmButton = buttons.find(btn => 
                          btn.textContent.includes('ç¡®è®¤') || 
                          btn.textContent.includes('ç¡®å®š') ||
                          btn.textContent.includes('Confirm')
                        );
                        
                        return confirmButton || null;
                      });
                      
                      if (confirmButton) {
                        console.log('æ‰¾åˆ°ç¡®è®¤æŒ‰é’®ï¼Œç‚¹å‡»...');
                        await confirmButton.click();
                        await page.waitForTimeout(5000);
                        
                        console.log('ç»­è´¹æ“ä½œå·²æäº¤');
                        
                        // æ£€æŸ¥ç»­è´¹æ˜¯å¦æˆåŠŸ
                        const renewalSuccess = await page.evaluate(() => {
                          return document.body.textContent.includes('æˆåŠŸ') || 
                                 document.body.textContent.includes('success');
                        });
                        
                        if (renewalSuccess) {
                          console.log('ç»­è´¹æˆåŠŸï¼');
                          await sendTelegramMessage(`âœ… æµè§ˆå™¨è‡ªåŠ¨åŒ–: æœåŠ¡å™¨ ${FC_MACHINE_ID} ç»­è´¹æˆåŠŸï¼åŸå‰©ä½™: ${daysLeft} å¤©ã€‚`);
                        } else {
                          console.log('å¯èƒ½ç»­è´¹å¤±è´¥');
                          await sendTelegramMessage(`âš ï¸ æµè§ˆå™¨è‡ªåŠ¨åŒ–: æœåŠ¡å™¨ ${FC_MACHINE_ID} ç»­è´¹æ“ä½œå·²æäº¤ï¼Œä½†ç»“æœä¸ç¡®å®šã€‚è¯·æ‰‹åŠ¨æ£€æŸ¥ã€‚åŸå‰©ä½™: ${daysLeft} å¤©ã€‚`);
                        }
                      } else {
                        console.log('æœªæ‰¾åˆ°ç¡®è®¤æŒ‰é’®');
                        await sendTelegramMessage(`â“ æµè§ˆå™¨è‡ªåŠ¨åŒ–: æœåŠ¡å™¨ ${FC_MACHINE_ID} æ‰¾ä¸åˆ°ç»­è´¹ç¡®è®¤æŒ‰é’®ã€‚è¯·æ‰‹åŠ¨ç»­è´¹ã€‚å‰©ä½™: ${daysLeft} å¤©ã€‚`);
                      }
                    } else {
                      console.log('æœªæ‰¾åˆ°ç»­è´¹æŒ‰é’®');
                      await sendTelegramMessage(`â“ æµè§ˆå™¨è‡ªåŠ¨åŒ–: æœåŠ¡å™¨ ${FC_MACHINE_ID} æ‰¾ä¸åˆ°ç»­è´¹æŒ‰é’®ã€‚è¯·æ‰‹åŠ¨ç»­è´¹ã€‚å‰©ä½™: ${daysLeft} å¤©ã€‚`);
                    }
                  } else {
                    console.log(`å‰©ä½™å¤©æ•°ä¸º ${daysLeft} å¤©ï¼Œæ— éœ€ç»­è´¹`);
                    await sendTelegramMessage(`â„¹ï¸ æµè§ˆå™¨è‡ªåŠ¨åŒ–: æœåŠ¡å™¨ ${FC_MACHINE_ID} å‰©ä½™ ${daysLeft} å¤©ï¼Œæ— éœ€ç»­è´¹ã€‚`);
                  }
                } else {
                  console.log(`æœªèƒ½æ‰¾åˆ°æœåŠ¡å™¨ ${FC_MACHINE_ID} çš„å‰©ä½™å¤©æ•°ä¿¡æ¯`);
                  await sendTelegramMessage(`âš ï¸ æµè§ˆå™¨è‡ªåŠ¨åŒ–: æœªèƒ½æ‰¾åˆ°æœåŠ¡å™¨ ${FC_MACHINE_ID} çš„ä¿¡æ¯ï¼Œæ— æ³•ç»­è´¹ã€‚`);
                }
              } else {
                console.log('ç™»å½•å¤±è´¥');
                
                // æˆªå›¾ä¿å­˜ç™»å½•å¤±è´¥é¡µé¢
                await page.screenshot({ path: 'login_failed.png' });
                
                await sendTelegramMessage(`ğŸ”´ æµè§ˆå™¨è‡ªåŠ¨åŒ–: ç™»å½•Freecloudå¤±è´¥ï¼Œæ— æ³•ç»­è´¹ã€‚`);
              }
            } catch (error) {
              console.error('æµè§ˆå™¨è‡ªåŠ¨åŒ–è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯:', error);
              await sendTelegramMessage(`âŒ æµè§ˆå™¨è‡ªåŠ¨åŒ–: è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯: ${error.message}`);
            } finally {
              await browser.close();
              console.log('æµè§ˆå™¨å·²å…³é—­');
            }
          })();
          EOL
          
          echo "è¿è¡Œæµè§ˆå™¨è‡ªåŠ¨åŒ–è„šæœ¬..."
          node freecloud_puppeteer.js 
